# üõ†Ô∏è Development Setup

Get your development environment ready for working with the Enhanced Medusa Next.js Starter and Companion Panel System.

## Prerequisites

### System Requirements

- **Node.js**: 18.0 or higher
- **Package Manager**: npm, yarn, or pnpm
- **Git**: Latest version
- **Code Editor**: VS Code recommended

### Required Services

- **Medusa Server**: Running on port 9000
- **Database**: PostgreSQL (for Medusa)
- **Redis**: For caching (optional but recommended)

## Quick Setup

### 1. Clone and Install

```bash
# Clone the repository
git clone https://github.com/your-org/medusa-nextjs-companion.git
cd medusa-nextjs-companion

# Install dependencies
npm install
# or
yarn install
```

### 2. Environment Configuration

```bash
# Copy environment template
cp .env.template .env.local

# Edit with your configuration
nano .env.local
```

### 3. Environment Variables

```bash
# .env.local

# Medusa Configuration
NEXT_PUBLIC_MEDUSA_BACKEND_URL=http://localhost:9000
NEXT_PUBLIC_BASE_URL=http://localhost:8000

# Companion Panel Features
NEXT_PUBLIC_COMPANION_PANELS_ENABLED=true
NEXT_PUBLIC_AI_COMPANION_ENABLED=true
NEXT_PUBLIC_HELP_SYSTEM_ENABLED=true

# Builder.io Integration
NEXT_PUBLIC_BUILDER_PUBLIC_KEY=your_builder_public_key
BUILDER_PRIVATE_KEY=your_builder_private_key

# Stripe Integration
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_...
STRIPE_SECRET_KEY=sk_test_...

# AI Services (Optional)
OPENAI_API_KEY=sk-...
ANTHROPIC_API_KEY=sk-ant-...

# Analytics (Optional)
NEXT_PUBLIC_GA_MEASUREMENT_ID=G-...
NEXT_PUBLIC_MIXPANEL_TOKEN=...

# Feature Flags
NEXT_PUBLIC_FEATURE_WISHLIST=true
NEXT_PUBLIC_FEATURE_COMPARE=true
NEXT_PUBLIC_FEATURE_REVIEWS=true
```

### 4. Start Development Server

```bash
# Start the development server
npm run dev
# or
yarn dev

# Server will be available at http://localhost:3000
```

## Medusa Server Setup

### Quick Medusa Setup

```bash
# Create a new Medusa project
npx create-medusa-app@latest medusa-backend

# Navigate to the backend directory
cd medusa-backend

# Start the Medusa server
npm run develop

# Server will be available at http://localhost:9000
```

### Medusa Configuration

```javascript
// medusa-config.js
module.exports = {
  projectConfig: {
    redis_url: process.env.REDIS_URL,
    database_url: process.env.DATABASE_URL,
    database_type: "postgres",
    store_cors: process.env.STORE_CORS || "http://localhost:3000",
    admin_cors: process.env.ADMIN_CORS || "http://localhost:7000,http://localhost:7001",
  },
  plugins: [
    // Essential plugins
    `medusa-fulfillment-manual`,
    `medusa-payment-manual`,
    // Add more plugins as needed
  ],
}
```

## Development Tools

### VS Code Extensions

Install these recommended extensions:

```json
{
  "recommendations": [
    "bradlc.vscode-tailwindcss",
    "esbenp.prettier-vscode",
    "dbaeumer.vscode-eslint",
    "ms-vscode.vscode-typescript-next",
    "formulahendry.auto-rename-tag",
    "christian-kohler.path-intellisense",
    "ms-vscode.vscode-json"
  ]
}
```

### TypeScript Configuration

The project includes comprehensive TypeScript configuration:

```json
// tsconfig.json
{
  "compilerOptions": {
    "target": "es5",
    "lib": ["dom", "dom.iterable", "es6"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"],
      "@/components/*": ["./src/components/*"],
      "@/store/*": ["./src/store/*"],
      "@/lib/*": ["./src/lib/*"],
      "@/types/*": ["./src/types/*"]
    }
  }
}
```

### ESLint Configuration

```javascript
// .eslintrc.js
module.exports = {
  extends: [
    'next/core-web-vitals',
    '@typescript-eslint/recommended',
    'prettier'
  ],
  rules: {
    '@typescript-eslint/no-unused-vars': 'error',
    '@typescript-eslint/no-explicit-any': 'warn',
    'react-hooks/exhaustive-deps': 'error',
    'prefer-const': 'error'
  }
}
```

## Development Scripts

### Available Scripts

```json
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "lint:fix": "next lint --fix",
    "type-check": "tsc --noEmit",
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage",
    "storybook": "storybook dev -p 6006",
    "build-storybook": "storybook build"
  }
}
```

### Development Workflow

```bash
# Check types
npm run type-check

# Run linting
npm run lint

# Fix linting issues
npm run lint:fix

# Run tests
npm run test

# Run tests in watch mode
npm run test:watch
```

## Testing Setup

### Jest Configuration

```javascript
// jest.config.js
module.exports = {
  testEnvironment: 'jsdom',
  setupFilesAfterEnv: ['<rootDir>/jest.setup.js'],
  moduleNameMapping: {
    '^@/(.*)$': '<rootDir>/src/$1',
  },
  testPathIgnorePatterns: ['<rootDir>/.next/', '<rootDir>/node_modules/'],
  collectCoverageFrom: [
    'src/**/*.{js,jsx,ts,tsx}',
    '!src/**/*.d.ts',
  ],
}
```

### Testing Utilities

```typescript
// src/test-utils/index.tsx
import { render } from '@testing-library/react'
import { CompanionPanelProvider } from '@/store/companion-panel'

export function renderWithProviders(ui: React.ReactElement) {
  return render(
    <CompanionPanelProvider>
      {ui}
    </CompanionPanelProvider>
  )
}

export * from '@testing-library/react'
```

## Debugging

### Browser DevTools

Enable React Developer Tools:
1. Install React Developer Tools extension
2. Enable "Companion Panel" context in React DevTools
3. Monitor state changes and re-renders

### Debug Configuration

```json
// .vscode/launch.json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Next.js: debug server-side",
      "type": "node-terminal",
      "request": "launch",
      "command": "npm run dev"
    },
    {
      "name": "Next.js: debug client-side",
      "type": "chrome",
      "request": "launch",
      "url": "http://localhost:3000"
    }
  ]
}
```

### Logging

```typescript
// utils/logger.ts
export const logger = {
  debug: (message: string, data?: any) => {
    if (process.env.NODE_ENV === 'development') {
      console.log(`[DEBUG] ${message}`, data)
    }
  },
  error: (message: string, error?: Error) => {
    console.error(`[ERROR] ${message}`, error)
  }
}
```

## Hot Reload & Fast Refresh

The development server supports:
- **Fast Refresh**: React components update without losing state
- **Hot Reload**: CSS and configuration changes apply instantly
- **TypeScript**: Type checking in real-time

## Performance Monitoring

### Development Metrics

```typescript
// Enable in development
if (process.env.NODE_ENV === 'development') {
  import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {
    getCLS(console.log)
    getFID(console.log)
    getFCP(console.log)
    getLCP(console.log)
    getTTFB(console.log)
  })
}
```

## Troubleshooting

### Common Issues

1. **Port Already in Use**
   ```bash
   # Kill process on port 3000
   lsof -ti:3000 | xargs kill -9
   ```

2. **Module Resolution Issues**
   ```bash
   # Clear Next.js cache
   rm -rf .next
   npm run dev
   ```

3. **TypeScript Errors**
   ```bash
   # Restart TypeScript server in VS Code
   Cmd/Ctrl + Shift + P > "TypeScript: Restart TS Server"
   ```

## Next Steps

- [Testing Guide](/testing)
- [Deployment Guide](/deployment)
- [Configuration Overview](/configuration/overview)
- [Troubleshooting](/troubleshooting/common-issues)